{% extends 'irrigation/base.html' %}

{% block title %}Enter Verification Code{% endblock %}

{% block content %}
<div class="max-w-md mx-auto mt-10 bg-white p-6 rounded-lg shadow-lg">
    <h2 class="text-2xl font-bold mb-6 text-green-600 text-center">Enter Verification Code</h2>

    {% if messages %}
        {% for message in messages %}
            <div class="mb-4 p-4 {% if message.tags == 'success' %}bg-green-100 text-green-700{% elif message.tags == 'warning' %}bg-yellow-100 text-yellow-700{% else %}bg-red-100 text-red-700{% endif %} rounded">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded">
        <p class="text-blue-800">
            ðŸ“± We sent a 6-digit verification code to your phone number ending with
            <strong>****{{ phone_number|slice:"-4:" }}</strong>
        </p>
    </div>

    <form method="post" class="space-y-4">
        {% csrf_token %}

        <div>
            <label for="code" class="block text-sm font-medium text-gray-700 mb-2">
                6-Digit Verification Code:
            </label>
            <input type="text"
                   name="code"
                   id="code"
                   maxlength="6"
                   minlength="6"
                   pattern="[0-9]{6}"
                   required
                   placeholder="123456"
                   class="w-full px-3 py-2 border rounded text-center text-xl tracking-widest"
                   autocomplete="one-time-code"
                   inputmode="numeric">
            <p class="text-sm text-gray-600 mt-1">Enter the code sent to your phone</p>
        </div>

        <button type="submit" class="w-full bg-green-600 text-white py-3 px-4 rounded-lg text-lg font-semibold">
            Verify Code
        </button>
    </form>

    <div class="mt-6 space-y-3">
        <div class="text-center">
            <p class="text-sm text-gray-600">Didn't receive the code?</p>
            <form method="post" action="{% url 'password_reset_sms_resend' %}" class="inline">
                {% csrf_token %}
                <button type="submit" class="text-blue-600 hover:underline text-sm">
                    Resend code
                </button>
            </form>
        </div>

        <div class="text-center">
            <a href="{% url 'password_reset_sms_quick' %}" class="text-blue-600 hover:underline text-sm">
                Use different phone number
            </a>
        </div>

        <div class="text-center">
            <a href="{% url 'password_reset' %}" class="text-gray-600 hover:underline text-sm">
                Try email reset instead
            </a>
        </div>
    </div>
</div>

<script>
// Auto-submit when 6 digits are entered
document.getElementById('code').addEventListener('input', function(e) {
    if (this.value.length === 6) {
        this.form.submit();
    }
});

// Auto-focus on the code field
document.getElementById('code').focus();
</script>
{% endblock %}
